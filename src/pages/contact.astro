---
import { db, Users } from 'astro:db';
import { z } from 'astro:content';

import Layout from "@layouts/Layout.astro"
import Section from "@components/Section.astro"

if (Astro.request.method === 'POST') {

    const formSchema = z.object({
        name: z.string(),
        email: z.string().email(),
        message: z.string(),
        company: z.string(),
    })

    const formData = await Astro.request.formData();

    const name = formData.get('name');
    const email = formData.get('email');
    const message = formData.get('message');
    const company = formData.get('company');

    const contactFormData = {
        name,
        email,
        message,
        company
    } 

    const validateData = formSchema.parse(contactFormData)

    if(validateData) {

        await db.insert(Users).values(validateData)
        
    }

}

---

<Layout title="Contact" description="test">
    <Section>
        <div class="md:max-w-screen-md mx-auto text-center">
            <h1 class="mb-8">
                <span class="text-primary">Say Hi!</span>
                and tell me about your idea
            </h1>
            <p class="text-2xl ">Have a nice works? Reach out and let's chat.</p>
        </div>
    </Section>
    <Section>
        <form method="POST">
            <input type="text" name="name">
            <input type="email" name="email" id="">
            <input type="text" name="company">
            <textarea name="message" id="" cols="30" rows="10"></textarea>
            <input type="submit" value="Send">
        </form>
    </Section>
</Layout>